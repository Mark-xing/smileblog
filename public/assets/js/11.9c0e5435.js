(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{465:function(s,t,a){"use strict";a.r(t);var e=a(4),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[s._v("#")]),s._v(" 同源策略")]),s._v(" "),a("p",[s._v("在说跨域之前，首先需要了解的一个概念就是”同源策略“。")]),s._v(" "),a("h3",{attrs:{id:"什么是源？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是源？"}},[s._v("#")]),s._v(" 什么是源？")]),s._v(" "),a("p",[s._v("源=协议+域名+端口号。")]),s._v(" "),a("p",[s._v("如果两个 url 的协议、域名、端口号完全一致，那么这两个 url 就是同源的。")]),s._v(" "),a("p",[s._v("我们可以通过"),a("code",[s._v("window.origin")]),s._v("或"),a("code",[s._v("location.origin")]),s._v("得到当前源。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nhttps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("smile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//不同源，域名不一致（记住：只有完全一模一样才算同源）")]),s._v("\n\nhttp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html\nhttp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//同源")]),s._v("\n\nlocalhost 调用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//不同源")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"什么是同源策略？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是同源策略？"}},[s._v("#")]),s._v(" 什么是同源策略？")]),s._v(" "),a("p",[a("strong",[s._v("同源策略即")]),s._v("：不同源之间的页面，不准互相访问数据。")]),s._v(" "),a("p",[s._v("浏览器规定：如果 JS 运行在源 A 里，那么就只能获取源 A 的数据，不能获取源 B 的数据，即不允许跨域。")]),s._v(" "),a("p",[s._v("假设 "),a("code",[s._v("wang.com/index.html")]),s._v("引用了"),a("code",[s._v("smile.com/1.js")]),s._v(",那么就说"),a("code",[s._v("1.js")]),s._v("运行在源"),a("code",[s._v("wang.com")]),s._v("里\n注意，这和"),a("code",[s._v("smile.com")]),s._v("没有关系，虽然"),a("code",[s._v("1.js")]),s._v("是从它那里下载的.\n所以"),a("code",[s._v("1.js")]),s._v("就只能获取"),a("code",[s._v("wang.com")]),s._v("的数据,这就是浏览器的功能，浏览器就是故意这样设计的。")]),s._v(" "),a("h3",{attrs:{id:"为什么会有同源策略？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么会有同源策略？"}},[s._v("#")]),s._v(" 为什么会有同源策略？")]),s._v(" "),a("p",[s._v("之所以需要使用同源策略，就是为了保护用户的隐私。")]),s._v(" "),a("p",[s._v("以微信为例，源为 "),a("code",[s._v("https://user.weixin.com")]),s._v("，假设当前用户已经登录，并且 AJAX 请求")]),s._v(" "),a("p",[a("code",[s._v("/friends.jso")]),s._v("n 可以获取用户好友列表。")]),s._v(" "),a("p",[s._v("这个时候黑客来了，他把 "),a("code",[s._v("https://user-winxin.com")]),s._v("分享给你，实际上这是一个钓鱼网站，你")]),s._v(" "),a("p",[s._v("点开这个网页，这个网页也请求你的好友列表 "),a("code",[s._v("https://user.weixin.com/friends.json")]),s._v("。")]),s._v(" "),a("p",[s._v("请问，这个时候你的好友列表是不是就被黑客给黑了？")]),s._v(" "),a("h3",{attrs:{id:"问题的根源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题的根源"}},[s._v("#")]),s._v(" 问题的根源")]),s._v(" "),a("p",[s._v("之所以会出现这个问题，其根源就在于无法区分发送者。")]),s._v(" "),a("p",[s._v("微信里面的"),a("code",[s._v("JS")]),s._v("和黑客的"),a("code",[s._v("JS")]),s._v("发送到请求几乎没有区别（referer 区别）")]),s._v(" "),a("p",[s._v("但是如果后台的开发者没有检查 "),a("code",[s._v("referer")]),s._v("，那么就完全没有区别。")]),s._v(" "),a("p",[s._v("所以，如果没有同源策略，任何页面都能偷走微信里面的数据，甚至是支付宝里面的余额。")]),s._v(" "),a("h3",{attrs:{id:"安全原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全原则"}},[s._v("#")]),s._v(" 安全原则")]),s._v(" "),a("p",[s._v("有的小伙伴可能会问，既然"),a("code",[s._v("referer")]),s._v("有区别，那检查"),a("code",[s._v("referer")]),s._v("不就好了？")]),s._v(" "),a("p",[s._v("安全原则：安全链条上的强度取决于安全链条上最弱的一环。")]),s._v(" "),a("p",[s._v("同时，万一这个网站的后端开发者是一个傻叉呢？\n所以浏览器应该主动预防这种偷数据的行为。")]),s._v(" "),a("p",[s._v("总之，为了保护用户的隐私，浏览器设置了严格的同源策略。\n如果浏览器不限制跨域，一定是这个浏览器出现了"),a("code",[s._v("bug")])]),s._v(" "),a("h2",{attrs:{id:"跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[s._v("#")]),s._v(" 跨域")]),s._v(" "),a("h3",{attrs:{id:"什么是跨域？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是跨域？"}},[s._v("#")]),s._v(" 什么是跨域？")]),s._v(" "),a("p",[s._v("跨域，即浏览器试图执行其他网站的脚本。但是由于同源策略的限制，导致我们无法实现跨域。")]),s._v(" "),a("h3",{attrs:{id:"关于跨域的几个问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于跨域的几个问题"}},[s._v("#")]),s._v(" 关于跨域的几个问题")]),s._v(" "),a("p",[a("strong",[s._v("为什么"),a("code",[s._v("a.wang.com")]),s._v("访问"),a("code",[s._v("wang.com")]),s._v("也算跨域？")])]),s._v(" "),a("p",[s._v("因为历史上，出现过不同的公司共用域名，a.wang.com 和 wang.com 不一定是同一个网站，浏览器谨慎起见，认为这是不同的源。")]),s._v(" "),a("p",[a("strong",[s._v("为什么不同端口也算跨域？")])]),s._v(" "),a("p",[s._v("原因同上，一个端口一个公司的情况也不是没有的。")]),s._v(" "),a("p",[s._v("记住：安全链条的强度取决于最弱的一环，所有和安全相关的问题都要谨慎对待。")]),s._v(" "),a("p",[a("strong",[s._v("为什么两个网站的 IP 一样，也算跨域？")])]),s._v(" "),a("p",[s._v("原因同上，因为 IP 也是可以共用的。")]),s._v(" "),a("p",[a("strong",[s._v("为什么可以跨域使用 CSS、JS 和图片等？")])]),s._v(" "),a("p",[s._v("同源策略限制的是数据访问，我们引用 CSS、JS 和图片的时候，其实并不知道其内容，我们只是在引用。")]),s._v(" "),a("h2",{attrs:{id:"cors-跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors-跨域"}},[s._v("#")]),s._v(" CORS 跨域")]),s._v(" "),a("h3",{attrs:{id:"什么是-cors？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-cors？"}},[s._v("#")]),s._v(" 什么是 CORS？")]),s._v(" "),a("p",[a("code",[s._v("CORS")]),s._v('的全称是"跨域资源共享"（Cross-origin resource sharing）。 它允许浏览器向跨源服务器，发出'),a("code",[s._v("XMLHttpRequest")]),s._v("请求，从而克服了"),a("code",[s._v("AJAX")]),s._v("只能同源使用的限制。")]),s._v(" "),a("h3",{attrs:{id:"如何理解-cors？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何理解-cors？"}},[s._v("#")]),s._v(" 如何理解 CORS？")]),s._v(" "),a("p",[s._v("如果"),a("code",[s._v("wang.com")]),s._v("和"),a("code",[s._v("smile.com")]),s._v("这两个网站都是我的，我就是想让"),a("code",[s._v("wang.com")]),s._v("去访问"),a("code",[s._v("smile.com")]),s._v("里面的数据应该怎么办呢？\n只需要"),a("code",[s._v("wang.com")]),s._v("在响应头里写"),a("code",[s._v("smile.com")]),s._v("可以访问即可。这就是"),a("code",[s._v("CORS")]),s._v("。\n实现"),a("code",[s._v("CORS")]),s._v("通信的关键是服务器。只要服务器实现了"),a("code",[s._v("CORS")]),s._v("接口，就可以跨源通信。")]),s._v(" "),a("h3",{attrs:{id:"两种请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两种请求"}},[s._v("#")]),s._v(" 两种请求")]),s._v(" "),a("p",[a("code",[s._v("CORS")]),s._v("跨域分为两种请求，一种是"),a("strong",[s._v("简单请求")]),s._v("，另外一种就是"),a("strong",[s._v("复杂请求")]),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[s._v("#")]),s._v(" 简单请求")]),s._v(" "),a("p",[s._v("只要满足以下条件的就是简单请求：")]),s._v(" "),a("ul",[a("li",[s._v("请求方式为"),a("code",[s._v("HEAD")]),s._v("、"),a("code",[s._v("POST")]),s._v(" 或者 "),a("code",[s._v("GET")])]),s._v(" "),a("li",[s._v("http 头信息不超出以下字段："),a("code",[s._v("Accept")]),s._v("、"),a("code",[s._v("Accept-Language")]),s._v(" 、 "),a("code",[s._v("Content-Language")]),s._v("、\n"),a("code",[s._v("Last-Event-ID")]),s._v("、\n"),a("code",[s._v("Content-Type")]),s._v("(限于三个值："),a("code",[s._v("application/x-www-form-urlencoded")]),s._v("、"),a("code",[s._v("multipart/form-data")]),s._v("、"),a("code",[s._v("text/plain")]),s._v(")\n简单请求的实现具体来说就是在信息头中加入一个 Origin 字段：")])]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cors "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\nOrigin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nHost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ergou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nAccept"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Language"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" en"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("US")]),s._v("\nConnection"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" keep"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alive\nUser"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Agent"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Mozilla"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("code",[s._v("Origin")]),s._v("的作用就是用来说明本次请求来自哪个源，服务器会根据"),a("code",[s._v("Origin")]),s._v("的值来判断是否接受本次请求。")]),s._v(" "),a("p",[s._v("如果"),a("code",[s._v("Origin")]),s._v("所表示的源不被服务器接受，即浏览器发现回应的信息头中没有"),a("code",[s._v("Access-Control-Allow-Origin")]),s._v("字段，就会自动抛出一个错误。")]),s._v(" "),a("p",[s._v("注意：这种错误是无法通过状态码识别的，这也是通过"),a("code",[s._v("CORS")]),s._v("实现跨域请求的一个弊端。\n如果"),a("code",[s._v("Origin")]),s._v("所表示的源被服务器端所接受，那么服务器就会返回如下响应：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("Access"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("smile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Credentials"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Expose"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" FooBar\nContent"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" charset"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("Access-Control-Allow-Origin")]),s._v("\n:该字段是必须的。它的值要么是请求时"),a("code",[s._v("Origin")]),s._v("字段的值，要么是一个*，表示接受任意域名的请求")]),s._v(" "),a("li",[a("code",[s._v("Access-Control-Allow-Credentials:")]),s._v("\n该字段可选。它的值是一个布尔值，表示是否允许发送"),a("code",[s._v("Cookie")]),s._v("。默认情况下，"),a("code",[s._v("Cookie")]),s._v("不包括在"),a("code",[s._v("CORS")]),s._v("请求之中。设为"),a("code",[s._v("true")]),s._v("，即表示服务器明确许可，"),a("code",[s._v("Cookie")]),s._v("可以包含在请求中，一起发给服务器。这个值也只能设为"),a("code",[s._v("true")]),s._v("，如果服务器不要浏览器发送"),a("code",[s._v("Cookie")]),s._v("，删除该字段即可。(注意：如果要发送"),a("code",[s._v("cookie")]),s._v("，不仅要进行上述的设置，还要在"),a("code",[s._v("AJAX")]),s._v("请求中设置"),a("code",[s._v("withCredentials")]),s._v("属性）")]),s._v(" "),a("li",[a("code",[s._v("Access-Control-Expose-Headers:")]),s._v("该字段可选。"),a("code",[s._v("CORS")]),s._v("请求时，"),a("code",[s._v("XMLHttpRequest")]),s._v("对象的"),a("code",[s._v("getResponseHeader()")]),s._v("方法只能拿到 6 个基本字段："),a("code",[s._v("Cache-Control")]),s._v("、"),a("code",[s._v("Content-Language")]),s._v("、"),a("code",[s._v("Content-Type")]),s._v("、"),a("code",[s._v("Expires")]),s._v("、"),a("code",[s._v("Last-Modified")]),s._v("、"),a("code",[s._v("Pragma")]),s._v("。如果想拿到其他字段，就必须在"),a("code",[s._v("Access-Control-Expose-Headers")]),s._v("里面指定。")])]),s._v(" "),a("h4",{attrs:{id:"复杂请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复杂请求"}},[s._v("#")]),s._v(" 复杂请求")]),s._v(" "),a("p",[s._v("所谓复杂请求，即不满足上述条件的请求就是复杂请求。")]),s._v(" "),a("p",[s._v("比如请求的方法是"),a("code",[s._v("PUT")]),s._v("或"),a("code",[s._v("DELETE")]),s._v("，或者"),a("code",[s._v("Content-Type")]),s._v("字段的类型是"),a("code",[s._v("application/json")]),s._v("。")]),s._v(" "),a("p",[s._v("复杂请求首先会发起一个预检请求，该请求是 "),a("code",[s._v("option")]),s._v(" 方法的，通过该请求来知道服务端是否允许跨域请求。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://api.wang.com/cors"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PUT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Custom-Header"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("上面的请求就是一个复杂请求，当浏览器发现这是一个复杂请求之后，就会主动发出一个预检请求，询问服务器是否允许本次请求。")]),s._v(" "),a("p",[s._v("服务器收到预检请求之后，检查了"),a("code",[s._v("Origin")]),s._v("、"),a("code",[s._v("Access-Control-Request-Method")]),s._v("和"),a("code",[s._v("Access-Control-Request-Headers")]),s._v("字段以后，确认允许跨源请求，才会做出相应的回应。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("Access"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nContent"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" charset"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"cors-存在的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors-存在的问题"}},[s._v("#")]),s._v(" CORS 存在的问题")]),s._v(" "),a("p",[s._v("不支持"),a("code",[s._v("IE8/9")]),s._v("，如果要在"),a("code",[s._v("IE8/9")]),s._v("使用"),a("code",[s._v("CORS")]),s._v("跨域需要使用"),a("code",[s._v("XDomainRequest")]),s._v("对象来支持 CORS")]),s._v(" "),a("h2",{attrs:{id:"jsonp-跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-跨域"}},[s._v("#")]),s._v(" JSONP 跨域")]),s._v(" "),a("h3",{attrs:{id:"什么是-jsonp？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-jsonp？"}},[s._v("#")]),s._v(" 什么是 JSONP？")]),s._v(" "),a("p",[s._v("我们在跨域的时候由于当前的浏览器不支持 "),a("code",[s._v("CORS")]),s._v(" 或者因为某些条件不支持 "),a("code",[s._v("CORS")]),s._v("，我们必须使用另外一种方式来跨域，于是我们就请求一个 "),a("code",[s._v("JS")]),s._v(" 文件，这个 "),a("code",[s._v("JS")]),s._v(" 文件会执行一个回调，回调里面就有我们需要的数据")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nscript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://www.wang.cn/login?username=wang&callback=callback"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"回调函数的名字是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回调函数的名字是什么？"}},[s._v("#")]),s._v(" 回调函数的名字是什么？")]),s._v(" "),a("p",[s._v("回调的名字是可以随机生成的的一个随机数，我们把这个名字当成 "),a("code",[s._v("callback")]),s._v(" 的参数传给后台，后台会把这个函数再次返回给我们并执行。")]),s._v(" "),a("h3",{attrs:{id:"jsonp-跨域优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-跨域优点"}},[s._v("#")]),s._v(" JSONP 跨域优点")]),s._v(" "),a("ul",[a("li",[s._v("兼容"),a("code",[s._v("ie")])]),s._v(" "),a("li",[s._v("可以跨域")])]),s._v(" "),a("h3",{attrs:{id:"jsonp-跨域缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-跨域缺点"}},[s._v("#")]),s._v(" JSONP 跨域缺点")]),s._v(" "),a("ul",[a("li",[s._v("由于是 "),a("code",[s._v("script")]),s._v(" 标签，所以读不到 "),a("code",[s._v("ajax")]),s._v(" 那么精确的状态，不知道状态码是什么，也不知道响应头是什么，它只知道成功和失败。")]),s._v(" "),a("li",[s._v("不支持"),a("code",[s._v("post")]),s._v("（因为是 "),a("code",[s._v("script")]),s._v(" 标签，所以只支持 "),a("code",[s._v("get")]),s._v(" 请求）")])])])}),[],!1,null,null,null);t.default=r.exports}}]);